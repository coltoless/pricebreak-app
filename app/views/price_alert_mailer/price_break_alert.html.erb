<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= @email_content[:subject] %></title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; }
      .container { max-width: 600px; margin: 0 auto; padding: 20px; }
      .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }
      .content { background: white; padding: 30px; border-radius: 0 0 8px 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
      .alert-box { background: #f8f9fa; border-left: 4px solid #007bff; padding: 20px; margin: 20px 0; border-radius: 4px; }
      .price-highlight { font-size: 2em; font-weight: bold; color: #28a745; text-align: center; margin: 20px 0; }
      .savings { background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; text-align: center; margin: 20px 0; }
      .cta-button { display: inline-block; background: #007bff; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; font-weight: bold; margin: 20px 0; }
      .cta-button:hover { background: #0056b3; }
      .footer { background: #f8f9fa; padding: 20px; text-align: center; font-size: 12px; color: #6c757d; border-radius: 0 0 8px 8px; }
      .route-info { background: #e9ecef; padding: 15px; border-radius: 8px; margin: 15px 0; }
      .urgency-urgent { border-left-color: #dc3545; }
      .urgency-significant { border-left-color: #28a745; }
      .urgency-minor { border-left-color: #ffc107; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><%= @email_content[:subject] %></h1>
        <p>Great news! We found a price break for your flight search.</p>
      </div>
      
      <div class="content">
        <p>Hello <%= user_display_name %>,</p>
        
        <div class="alert-box urgency-<%= @urgency %>">
          <h2><%= @smart_content[:alert_content][:route] %></h2>
          <div class="route-info">
            <p><strong>Departure:</strong> <%= @smart_content[:alert_content][:departure_date] %></p>
            <% if @alert.return_date %>
              <p><strong>Return:</strong> <%= @alert.return_date.strftime('%B %d, %Y') %></p>
            <% end %>
          </div>
        </div>
        
        <div class="price-highlight">
          <div style="font-size: 0.6em; color: #666;">Was: $<%= @smart_content[:alert_content][:original_price] %></div>
          <div>Now: $<%= @smart_content[:alert_content][:current_price] %></div>
        </div>
        
        <div class="savings">
          <h3>You Save: $<%= @smart_content[:alert_content][:savings][:amount] %> (<%= @smart_content[:alert_content][:savings][:percentage] %> off!)</h3>
        </div>
        
        <% if @smart_content[:alert_content][:urgency_message] %>
          <div class="alert-box">
            <p><strong><%= @smart_content[:alert_content][:urgency_message] %></strong></p>
          </div>
        <% end %>
        
        <div style="text-align: center; margin: 30px 0;">
          <a href="<%= generate_booking_url(@alert) %>" class="cta-button">
            <%= @smart_content[:call_to_action][:primary] %>
          </a>
        </div>
        
        <% if @smart_content[:context] %>
          <div class="alert-box">
            <h3>Additional Context</h3>
            <ul>
              <% if @smart_content[:context][:price_trend] %>
                <li><strong>Price Trend:</strong> <%= @smart_content[:context][:price_trend].humanize %></li>
              <% end %>
              <% if @smart_content[:context][:booking_window] %>
                <li><strong>Booking Window:</strong> <%= @smart_content[:context][:booking_window].humanize %></li>
              <% end %>
              <% if @smart_content[:context][:seasonal_factors] %>
                <li><strong>Seasonal Factor:</strong> <%= @smart_content[:context][:seasonal_factors][:factor].humanize %></li>
              <% end %>
            </ul>
          </div>
        <% end %>
        
        <% if @smart_content[:booking_recommendation] %>
          <div class="alert-box">
            <h3>Our Recommendation</h3>
            <p><strong><%= @smart_content[:booking_recommendation][:reason] %></strong></p>
            <p>Confidence: <%= @smart_content[:booking_recommendation][:confidence].humanize %></p>
            <% if @smart_content[:booking_recommendation][:alternatives] %>
              <p><strong>Alternatives:</strong></p>
              <ul>
                <% @smart_content[:booking_recommendation][:alternatives].each do |alternative| %>
                  <li><%= alternative %></li>
                <% end %>
              </ul>
            <% end %>
          </div>
        <% end %>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
          <h3>Quick Actions</h3>
          <p>
            <a href="<%= generate_manage_alerts_url %>" style="color: #007bff; text-decoration: none;">Manage Your Alerts</a> |
            <a href="<%= generate_booking_url(@alert) %>" style="color: #007bff; text-decoration: none;">View on Google Flights</a> |
            <a href="<%= generate_booking_url(@alert).gsub('google.com', 'kayak.com') %>" style="color: #007bff; text-decoration: none;">Check Kayak</a>
          </p>
        </div>
      </div>
      
      <div class="footer">
        <p>This alert was sent because you created a price alert for this route.</p>
        <p>
          <a href="<%= generate_unsubscribe_url(@alert) %>" style="color: #6c757d;">Unsubscribe from this alert</a> |
          <a href="<%= generate_manage_alerts_url %>" style="color: #6c757d;">Manage all alerts</a>
        </p>
        <p>Â© <%= Date.current.year %> PriceBreak. All rights reserved.</p>
      </div>
    </div>
  </body>
</html>
